FROM node:14-alpine

ARG NOTION_SECRET
ARG NOTION_DATABASE
ARG NOTION_STORAGE_DATABASE
ARG MASTER_ID
ARG MASTER_PW

ENV NOTION_SECRET=$NOTION_SECRET \
  NOTION_DATABASE=$NOTION_DATABASE \
  NOTION_STORAGE_DATABASE=$NOTION_STORAGE_DATABASE \
  MASTER_ID=$MASTER_ID \
  MASTER_PW=$MASTER_PW \
  NODE_ENV=production

WORKDIR /app/calories-log.net

COPY . .

RUN yarn

CMD ["yarn", "start"]
